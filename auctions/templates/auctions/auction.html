{% extends "auctions/layout.html" %}

{% block main %}
    <article>
    {% if auction.closed == True %}
        {% if user == bid.user %}
            <h1>You Won!</h1>
            <h2>Auction #{{auction.id}}</h2>
            <div>Title: {{auction.title}} Won by {{bid.user.username}}</div>
            <div>Description: {{ auction.description }}</div>
            <div>Category: {{auction.category}}</div>    
            <div><img src="{{ auction.image_url }}" width="200px"></div>
            <div>Price: {{auction.price}}$</div>
                <div>Comments: </div>
                {% for c in comments %}
                    <div>{{c.user.username}} commented: {{c.comment}}</div>
                {% empty %}
                    <div>No Comments</div>
                {% endfor %}
        {% endif %}
    {% else %}
        <h2>Auction #{{auction.id}}</h2>
        <div>Title: {{auction.title}}</div>
        <div>Description: {{ auction.description }}</div>
        <div>Category: {{auction.category}}</div>    
        <div><img src="{{ auction.image_url }}" width="200px"></div>
        {% if bid.user == auction.user %}
        <div>Current Price: {{auction.price}}$</div>
        {% else %}
        <div>Current Price: {{ auction.price }}$ from {{bid.user.username}}</div>
        {% endif %}
        {% if user.is_authenticated %}
            <form action="{% url 'auctions:makebid' bid.id auction.id %}" method="POST">
                {% csrf_token %}
                <input type="float" min="{{ bid.bid }}" name="bid" placeholder="Make Your Bid">
                <button type="submit">Bid</button>
            </form>
            <img></img>
            
            <div id="watchlist-icon" data-listing-id="{{ auction.id }}" class="{% if auction_in_watchlist %}on{% else %}off{% endif %}">
                <!-- maybe use different icons for on and off states -->
                {% if auction_in_watchlist %}Watchlisted{% else %}Not Watchlisted{% endif %}
            </div>

            <a id="wishlist" href="{% url 'auctions:addwishlist' auction.id %}">Add to watchlist</a><!--should make it where is only displays if its in the wishlist-->         
            {% if user == auction.user %}<!--fix this-->
                <a href="{% url 'auctions:closebid' auction.id %}">Close Bidding</a>
            {% endif %}

        {% endif %}
            <div>Comments: </div>
            {% for c in comments %}
                <div>{{c.user.username}} commented: {{c.comment}}</div>
            {% empty %}
                <div>No Comments Yet</div>
            {% endfor %}
        {% if user.is_authenticated %}
            <form action="{% url 'auctions:comment' auction.id %}" method="POST">
                {% csrf_token %}
                {{ commentform.as_p }}
                <br>
                <input class="btn btn-primary" type="submit" value="Comment">
            </form>
        {% endif %}
    {% endif %}
    </article>
{% endblock %}