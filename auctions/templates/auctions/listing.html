{% extends "auctions/layout.html" %}

{% block main %}
<h2>{{listing.title}}</h2>

{% if user.is_authenticated and listing.author != user or user.is_superuser %}
<div class="row">
    <form class="col-2" action="{% url 'watchlist_add_or_remove' listing.id %}" method="GET">
        <div>
            {% if listing.id and not is_on_watchlist %}
            <input name="add_to_watchlist" class="button" type="hidden" value="True"/>
            <input class="button" type="submit" value="Add to Watchlist"/>
            {% else %}
            <input name="remove_from_watchlist" class="button" type="hidden" value="True"/>
            <input class="button" type="submit" value="Remove from Watchlist"/>
            {% endif %}
        </div>
    </form>
    <form class="col-2" action="{% url 'remove_listing' listing.id %}" method="GET">
        <div>
            {% if user.is_superuser %}
            <input name="remove_listing" class="button-delete" type="submit" value="Remove Listing"/>
            {% endif %}
        </div>
    </form>
</div>
{% endif %}

<div class="row horizontal-space-evenly mt-50">
    <div class="card-gray">
        <div class="row">
            <div class="col-2">
                <label>Category</label>
                <div>{{listing.category}}</div>
            </div>
            <div class="col-2">
                <label>Current Bid</label>
                <div>${{listing.bid}}</div>
            </div>
        </div>
        <div class="border-bottom"></div>
        <div class="row">
            <div class="col-2">
                <label>Description</label>
                <div>{{listing.description}}</div>
            </div>
            <div class="col-2">
                <label>Posted By</label>
                <div>{{listing.author}}</div>
            </div>
        </div>
    </div>
    {% if user.is_authenticated and listing.author != user or user.is_superuser %}
    <div class="col-3">
        <div class="card-blue p-25 text-center">
            <form method="POST">{% csrf_token %}
                <label><b>Place Bid</b></label>
                <br/>
                <div class="place_bid">
                    <span class="dollar-sign">$</span>
                    <input type="number" name="place_bid" id="place_bid_field" min="{{min_bid}}" placeholder="0.00" required/>
                    <input class="button" id="place_bid_button" type="submit" value="Place Bid"/>
                </div>
            </form>
        </div>
    </div>
    {% endif %}
</div>
{% if listing.author != user or user.is_superuser %}
<div class="row horizontal-space-evenly">
    <div class="col-2">
        <h4>Comments</h4>
        <div class="card-gray vertical-space-evenly">
            {% for comment in comments %}
            <div class="row center">
                <div class="col-2 card-gray p-25">
                    {{comment.author}} commented: {{comment.comment}}
                </div>
                <form action="{% url 'remove_comment' comment.id %}" method="GET">
                    <div>
                        {% if user.is_superuser %}
                        <input name="remove_comment" class="button-delete" type="submit" value="Remove Comment"/>
                        {% endif %}
                    </div>
                </form>
            </div>
            {% endfor %}
            <form id="listing_comments" accept="{% url 'listing' listing.id %}" method="POST">{% csrf_token %}
                <div class="comment_input">
                    <textarea name="comment_input" type="text" placeholder="Comment on this listing!"></textarea>
                    <input class="button" type="submit"/>
                </div>
            </form>
        </div>
    </div>
    <div class="col-2">
        <h4>Bids</h4>
        <div class="card-gray vertical-space-evenly">
            {% for comment in comments %}
            <div class="row center">
                <div class="col-2 card-gray p-25">
                    {{comment.author}} commented: {{comment.comment}}
                </div>
                <form action="{% url 'remove_comment' comment.id %}" method="GET">
                    <div>
                        {% if user.is_superuser %}
                        <input name="remove_comment" class="button-delete" type="submit" value="Remove Comment"/>
                        {% endif %}
                    </div>
                </form>
            </div>
            {% endfor %}
            <form id="listing_comments" accept="{% url 'listing' listing.id %}" method="POST">{% csrf_token %}
                <div class="comment_input">
                    <textarea name="comment_input" type="text" placeholder="Comment on this listing!"></textarea>
                    <input class="button" type="submit"/>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}