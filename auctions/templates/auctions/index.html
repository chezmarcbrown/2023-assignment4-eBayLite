{% extends "auctions/layout.html" %}

{% block main %}
<h2>Active Listings</h2>
<form action="{% url 'displayCategory' %}" method="POST">
    {% csrf_token %}
    Choose category
    <select name="category" id="category">
        {% for item in categories %}
        <option value="{{item}}">{{item}}</option>
        {% endfor %}
    </select>
    <button type="submit">Select</button>
</form>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<article style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); row-gap: 10px">
    {% for listing in listings %}
        <div>
            <h2>{{ listing.title }}</h2>
            <img style="min-width: 150px; min-height: 100px; max-height: 20vw; max-width: 15vw;" src="{{ listing.imageUrl }}" alt="Product">
            <p>{{ listing.description }}</p>
            <p>${{ listing.price.bid }}</p>
            <a href="{% url 'listing' id=listing.id %}"><button>Info</button></a>
            {% if user.is_authenticated %}
                {% if listing in watchlist %}
                    <button class="removeFromWatchlistBtn active" data-listing-id="{{ listing.id }}" data-url="{% url 'removeWatchList' listing.id %}">
                        <i class="fas fa-eye-slash"></i>
                    </button>
                    <button class="addToWatchlistBtn" data-listing-id="{{ listing.id }}" data-url="{% url 'addWatchList' listing.id %}" style="display: none;">
                        <i class="fas fa-eye"></i>
                    </button>
                {% else %}
                    <button class="removeFromWatchlistBtn" data-listing-id="{{ listing.id }}" data-url="{% url 'removeWatchList' listing.id %}" style="display: none;">
                        <i class="fas fa-eye-slash"></i>
                    </button>
                    <button class="addToWatchlistBtn active" data-listing-id="{{ listing.id }}" data-url="{% url 'addWatchList' listing.id %}"">
                        <i class="fas fa-eye"></i>
                {% endif %}
            {% endif %}
        </div>
    {% endfor %}
</article>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const addToWatchlistBtns = document.querySelectorAll('.addToWatchlistBtn');
        const removeFromWatchlistBtns = document.querySelectorAll('.removeFromWatchlistBtn');

        addToWatchlistBtns.forEach((addToWatchlistBtn, index) => {
            const removeFromWatchlistBtn = removeFromWatchlistBtns[index];

            addToWatchlistBtn.addEventListener('click', function() {
                addToWatchlistBtn.style.display = 'none';
                removeFromWatchlistBtn.style.display = 'block';
                addToWatchlistBtn.classList.remove('active');
                removeFromWatchlistBtn.classList.add('active');
            });

            removeFromWatchlistBtn.addEventListener('click', function() {
                removeFromWatchlistBtn.style.display = 'none';
                addToWatchlistBtn.style.display = 'block';
                removeFromWatchlistBtn.classList.remove('active');
                addToWatchlistBtn.classList.add('active');
            });
        });
    });
</script>

{% endblock %}
