{% extends "auctions/layout.html" %}
{% load static %}
{% block main %}
<h2>{{header}}</h2>
<article>
    {% if message is not None %}
    {{message}}
    {% endif %}
    {% for listing in listings %}
    <section>
        <a href="{% url 'listing' listing.id %}">{{listing.title}}</a>
        {% if user.is_authenticated and listing.author != user or user.is_superuser %}
        <span id="watchlist_button">
            {% if listing not in watchlist %}
            <img id="{{listing.id}}" class="add" onclick="watchlist_button_click('{{listing.id}}')" src="{% static 'icons/heart-line.png' %}" data-value="False" data-listing-id="{{listing.id}}" title="Add To Watchlist"></img>
            {% else %}
            <img id="{{listing.id}}" class="remove" onclick="watchlist_button_click('{{listing.id}}')" src="{% static 'icons/heart-fill.png' %}" data-value="True" data-listing-id="{{listing.id}}" title="Remove From Watchlist"></img>
            {% endif %}
        </span>
        {% endif %}
    </section>
    {% endfor %}

    <script>
        
        function watchlist_button_click(listingId)
        {
            var btn = document.getElementById(listingId);
            console.log(listingId);
            fetch('../watchlist_add_or_remove/' + btn.dataset.listingId);
            
            // Add listing to watchlist
            if (btn.dataset.value === "False")
            {
                btn.dataset.value = "True";
                btn.src = "{% static 'icons/heart-fill.png' %}";
                btn.className = "remove";
            }
            // Remove listing from watchlist
            else
            {
                btn.dataset.value = "False";
                btn.src = "{% static 'icons/heart-line.png' %}"
                btn.className = "add";
            }
        }
    </script>

    <script>
        function add_comment(listingId) {
            
            var postBtn = document.getElementById('post');
            fetch('../add_comment/' + postBtn.dataset.listingId);

            postBtn.addEventListener("click", function() {
                var commentBoxValue = document.getElementById("comment_input").value;

                if (!document.getElementById("unordered").innerHTML.includes(commentBoxValue)) {
                    var div = document.createElement("div");
                    var commenterName = '{{ user.username }}';
                    div.className = "comment-box";

                    var text = document.createTextNode(commenterName + ' commented: ' + commentBoxValue);
                    div.appendChild(text);
                    document.getElementById("unordered").appendChild(div);
                    
                }
            });
        }
        
    </script>

</article>
{% endblock %}